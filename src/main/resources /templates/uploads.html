<?php
// рж╕рзЗрж╢ржи рж╢рзБрж░рзБ ржХрж░рж╛
session_start();

// "ржЖржЗржбрж┐ ржХрж╛рж░рзНржб" (рж╕рзЗрж╢ржи) ржЪрзЗржХ ржХрж░рж╛
// ржпржжрж┐ 'loggedin' рж╕рзЗрж╢ржи ржирж╛ ржерж╛ржХрзЗ, ржЕржержмрж╛ 'true' ржирж╛ рж╣рзЯ
if (!isset($_SESSION['loggedin']) || $_SESSION['loggedin'] !== true) {
    // ржЗржЙржЬрж╛рж░ржХрзЗ login.php ржкрзЗржЬрзЗ ржкрж╛ржарж┐рзЯрзЗ ржжрж┐ржи
    header('Location: login.php');
    exit;
}

// ржпржжрж┐ рж▓ржЧржЗржи ржарж┐ржХ ржерж╛ржХрзЗ, рждржмрзЗржЗ ржирж┐ржЪрзЗрж░ ржмрж╛ржХрж┐ HTML ржХрзЛржб ржжрзЗржЦрж╛ржмрзЗ
?>

<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ржЖржкрж▓рзЛржб рж╣ржУрзЯрж╛ ржлрж╛ржЗрж▓</title>
    
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            padding: 20px; 
            line-height: 1.6; 
            background-color: #f9f9f9;
        }
        h1 { 
            color: #333; 
            border-bottom: 2px solid #eee; 
            padding-bottom: 10px;
        }
        .file-list { 
            list-style-type: 'ЁЯУД'; /* ржлрж╛ржЗрж▓рзЗрж░ ржЗржорзЛржЬрж┐ */
            padding-left: 20px; 
        }
        .file-entry { 
            background: #ffffff; 
            margin-bottom: 10px; 
            padding: 10px 15px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .file-link {
            text-decoration: none;
            color: #0056b3;
            font-weight: 500;
            word-wrap: break-word; /* рж▓ржорзНржмрж╛ ржлрж╛ржЗрж▓рзЗрж░ ржирж╛ржо ржнрзЗржЩрзЗ ржжрзЗржЦрж╛ржмрзЗ */
        }
        .file-link:hover {
            text-decoration: underline;
        }
        .nav-link { 
            display: inline-block;
            margin-bottom: 20px;
            margin-right: 10px;
            padding: 8px 12px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
        .nav-link:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ЁЯУВ ржЖржкрж▓рзЛржб рж╣ржУрзЯрж╛ ржлрж╛ржЗрж▓</h1>
    <a href="index.html" class="nav-link">ржлрж░рзНржо ржкрзЗржЬрзЗ ржлрж┐рж░рзЗ ржпрж╛ржи</a>
    <a href="data.php" class="nav-link">ржЯрзЗржХрзНрж╕ржЯ ржбрзЗржЯрж╛ ржжрзЗржЦрзБржи</a>

    <ul class="file-list">
<a href="index.html" class="nav-link">ржлрж░рзНржо ржкрзЗржЬрзЗ ржлрж┐рж░рзЗ ржпрж╛ржи</a>
<a href="data.php" class="nav-link">ржЯрзЗржХрзНрж╕ржЯ ржбрзЗржЯрж╛ ржжрзЗржЦрзБржи</a> <a href="uploads.php" class="nav-link">ржлрж╛ржЗрж▓ ржжрзЗржЦрзБржи</a> <a href="change_password.php" class="nav-link" style="background-color: #17a2b8;">ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржкрж░рж┐ржмрж░рзНрждржи</a>

<a href="logout.php" class="nav-link" style="background-color: #dc3545;">рж▓ржЧржЖржЙржЯ</a>


        <?php
        $upload_dir = "uploads/";
        
        // ржлрж╛ржЗрж▓ржЯрж┐ ржЖржЫрзЗ ржХрж┐ржирж╛ ржПржмржВ ржПржЯрж┐ ржПржХржЯрж┐ ржлрзЛрж▓рзНржбрж╛рж░ ржХрж┐ржирж╛ рждрж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рж╛
        if (is_dir($upload_dir)) {
            
            // scandir() ржлрж╛ржВрж╢ржи ржлрзЛрж▓рзНржбрж╛рж░рзЗрж░ ржнрзЗрждрж░рзЗрж░ рж╕ржм ржлрж╛ржЗрж▓ ржУ ржлрзЛрж▓рзНржбрж╛рж░рзЗрж░ ржирж╛ржо ржПржХржЯрж┐ ржЕрзНржпрж╛рж░рзЗ рж╣рж┐рж╕рзЗржмрзЗ ржжрзЗрзЯ
            $files = scandir($upload_dir);
            
            // scandir() рж▓рж┐рж╕рзНржЯрзЗ '.' ржПржмржВ '..' (ржмрж░рзНрждржорж╛ржи ржУ ржкрзНржпрж╛рж░рзЗржирзНржЯ ржлрзЛрж▓рзНржбрж╛рж░) ржпрзЛржЧ ржХрж░рзЗ,
            // ржПржЧрзБрж▓рзЛ ржЖржорж╛ржжрзЗрж░ ржжрж░ржХрж╛рж░ ржирзЗржЗ, рждрж╛ржЗ ржмрж╛ржж ржжрж┐ржЪрзНржЫрж┐
            $filtered_files = array_diff($files, array('.', '..'));
            
            if (count($filtered_files) > 0) {
                // ржЕрзНржпрж╛рж░рзЗ ржЙрж▓рзНржЯрзЛ ржХрж░рзЗ ржжрж┐ржЪрзНржЫрж┐, ржпрж╛рждрзЗ ржирждрзБржи ржЖржкрж▓рзЛржб ржХрж░рж╛ ржлрж╛ржЗрж▓ ржЖржЧрзЗ ржжрзЗржЦрж╛ ржпрж╛рзЯ
                $filtered_files = array_reverse($filtered_files);
                
                foreach ($filtered_files as $file) {
                    // ржлрж╛ржЗрж▓рзЗрж░ ржЖрж╕рж▓ ржкрж╛рже
                    $file_path = $upload_dir . $file;
                    
                    // ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ ржЬржирзНржп ржлрж╛ржЗрж▓рзЗрж░ ржирж╛ржорзЗ htmlspecialchars ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛
                    $safe_filename = htmlspecialchars($file);
                    
                    echo "<li class='file-entry'>";
                    // ржлрж╛ржЗрж▓ржЯрж┐ ржЦрзЛрж▓рж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ рж▓рж┐ржЩрзНржХ рждрзИрж░рж┐ ржХрж░рж╛
                    // target="_blank" рж▓рж┐ржЩрзНржХржЯрж┐ржХрзЗ ржирждрзБржи ржЯрзНржпрж╛ржмрзЗ ржЦрзБрж▓ржмрзЗ
                    echo "<a href='{$file_path}' target='_blank' class='file-link'>{$safe_filename}</a>";
                    echo "</li>";
                }
            } else {
                echo "<li class='file-entry'>'uploads' ржлрзЛрж▓рзНржбрж╛рж░ржЯрж┐ ржПржЦржирзЛ ржЦрж╛рж▓рж┐ред</li>";
            }
        } else {
            echo "<li class='file-entry'>рждрзНрж░рзБржЯрж┐: 'uploads' ржлрзЛрж▓рзНржбрж╛рж░ржЯрж┐ ржЦрзБржБржЬрзЗ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред</li>";
        }
        ?>
    </ul>

</body>
</html>
